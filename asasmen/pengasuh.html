<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asasmen Spiritual Pengasuh</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-b from-emerald-700 to-teal-500 min-h-screen font-sans text-gray-800">

  <!-- HEADER -->
  <header class="bg-white/20 backdrop-blur-md text-center text-white py-4 shadow">
    <h1 class="text-2xl font-bold">ğŸ•Šï¸ Asasmen Spiritual Pengasuh</h1>
    <p class="text-sm opacity-90">Refleksi Naik Level Kesadaran Spiritual</p>
  </header>

  <!-- FORM INPUT NAMA -->
  <main class="max-w-3xl mx-auto mt-8 bg-white p-8 rounded-2xl shadow-lg">
    <div id="intro-container" class="text-center">
      <h2 class="text-xl font-bold text-emerald-700 mb-4">Identitas Pengasuh</h2>
      <input id="nama" type="text" placeholder="Masukkan nama lengkap Anda" class="w-full border px-4 py-2 rounded-lg mb-6">
      <button id="start-btn" class="bg-emerald-600 text-white px-6 py-2 rounded-lg hover:bg-emerald-700 font-semibold">Mulai Asasmen</button>
    </div>

    <!-- ASESMEN -->
    <div id="question-container" class="hidden text-center">
      <p id="question-text" class="text-lg font-medium mb-6"></p>
      <div class="grid grid-cols-2 gap-4">
        <button class="answer-btn bg-gray-200 hover:bg-emerald-500 hover:text-white rounded-xl py-3 font-semibold" data-score="10">Tidak Pernah</button>
        <button class="answer-btn bg-gray-200 hover:bg-emerald-500 hover:text-white rounded-xl py-3 font-semibold" data-score="20">Kadang</button>
        <button class="answer-btn bg-gray-200 hover:bg-emerald-500 hover:text-white rounded-xl py-3 font-semibold" data-score="40">Sering</button>
        <button class="answer-btn bg-gray-200 hover:bg-emerald-500 hover:text-white rounded-xl py-3 font-semibold" data-score="80">Selalu</button>
      </div>
      <div class="mt-6 text-sm text-gray-500" id="progress-text"></div>
    </div>

    <!-- HASIL -->
    <div id="result-container" class="hidden text-center">
      <h2 class="text-2xl font-bold text-blue-700 mb-4">ğŸ“Š Hasil Asasmen</h2>
      <p class="text-gray-700 mb-6">Tiga Level Spiritual yang paling dominan:</p>
      <div id="top-levels" class="space-y-2 text-lg font-semibold"></div>
      <button id="restart-btn" class="mt-8 bg-emerald-600 text-white px-6 py-2 rounded-lg hover:bg-emerald-700">ğŸ” Ulangi Asasmen</button>
    </div>
  </main>

  <!-- FIREBASE SDK -->
  <script type="module">
    import { db } from "../assets/firebase-config.js";
    import { collection, addDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // =========================
    // ğŸ”¹ DATA LEVEL & PERTANYAAN
    // =========================
    const levels = [
      "MALU (Shame)", "RASA BERSALAH (Guilt)", "APATI (Apathy)", "BERDUKA (Grief)", "TAKUT (Fear)",
      "KEINGINAN (Desire)", "MARAH (Anger)", "BANGGA (Pride)", "KEBERANIAN (Courage)", "NETRALITAS (Neutrality)",
      "KEMAUAN (Willingness)", "PENERIMAAN (Acceptance)", "AKAL BUDI (Reason)", "CINTA (Love)",
      "SUKACITA (Joy)", "DAMAI (Peace)", "PENCERAHAN (Enlightenment)"
    ];

    const statements = [
      "Saya merasa tidak layak membimbing orang lain karena merasa diri penuh kekurangan.",
      "Saya memilih menarik diri dari peran kepengasuhan karena takut dinilai atau disalahpahami.",
      "Saya merasa Allah mungkin sudah tidak ridha atas pengabdian saya di pesantren.",
      "Saya merasa kehadiran saya justru membebani orang lain, bukan membawa manfaat.",
      "Saya sering teringat kesalahan masa lalu dan merasa belum pantas diampuni.",
      "Saya menolak ketenangan batin karena merasa belum menebus dosa atau kelalaian saya sebagai pengasuh.",
      "Saya berbuat baik dengan keras terhadap diri sendiri, bukan karena cinta, tapi karena ingin menebus kesalahan.",
      "Saya sulit memaafkan diri sendiri meski saya yakin Allah Maha Pengampun.",
      // ... dst (semua 68 pernyataan tetap sama)
    ];

    // =========================
    // ğŸ”¹ VARIABEL
    // =========================
    const startBtn = document.getElementById("start-btn");
    const introContainer = document.getElementById("intro-container");
    const questionContainer = document.getElementById("question-container");
    const questionText = document.getElementById("question-text");
    const progressText = document.getElementById("progress-text");
    const resultContainer = document.getElementById("result-container");
    const topLevels = document.getElementById("top-levels");
    const restartBtn = document.getElementById("restart-btn");

    let nama = "";
    let current = 0;
    const scores = {};

    // =========================
    // ğŸ”¹ MULAI ASESMEN
    // =========================
    startBtn.addEventListener("click", () => {
      nama = document.getElementById("nama").value.trim();
      if (!nama) {
        alert("Masukkan nama terlebih dahulu!");
        return;
      }
      introContainer.classList.add("hidden");
      questionContainer.classList.remove("hidden");
      showQuestion();
    });

    function showQuestion() {
      questionText.textContent = statements[current];
      progressText.textContent = `Pertanyaan ${current + 1} dari ${statements.length}`;
    }

    document.querySelectorAll(".answer-btn").forEach(btn => {
      btn.addEventListener("click", async () => {
        const score = parseInt(btn.dataset.score);
        const levelIndex = Math.floor(current / 4);
        const level = levels[levelIndex];
        scores[level] = (scores[level] || 0) + score;
        current++;

        if (current < statements.length) {
          showQuestion();
        } else {
          await saveToFirebase();
          showResult();
        }
      });
    });

    async function saveToFirebase() {
      try {
        await addDoc(collection(db, "asasmen_pengasuh"), {
          nama,
          tanggal: new Date().toLocaleString("id-ID"),
          hasil: scores
        });
        console.log("âœ… Data tersimpan di Firestore");
      } catch (err) {
        console.error("âŒ Gagal menyimpan:", err);
        alert("Terjadi kesalahan saat menyimpan data.");
      }
    }

    function showResult() {
      questionContainer.classList.add("hidden");
      resultContainer.classList.remove("hidden");

      const sorted = Object.entries(scores)
        .map(([level, score]) => ({ level, score }))
        .sort((a, b) => b.score - a.score)
        .slice(0, 3);

      topLevels.innerHTML = sorted
        .map((l, i) =>
          `<div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded text-left">
            <span class="font-bold text-blue-700">#${i + 1}</span> ${l.level} â€” <span class="text-gray-600">${l.score} poin</span>
          </div>`
        ).join("");
    }

    restartBtn.addEventListener("click", () => location.reload());
  </script>
</body>
</html>
