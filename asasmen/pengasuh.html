<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asasmen Spiritual Pengasuh</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-emerald-700 to-teal-500 min-h-screen font-sans">

  <!-- HEADER -->
  <header class="bg-white/20 backdrop-blur-md shadow-lg text-center py-4 text-white">
    <h1 class="text-2xl font-bold tracking-wide">ğŸ•Šï¸ Asasmen Spiritual Pengasuh</h1>
    <p class="text-sm opacity-90">Panduan Naik Level Kesadaran Spiritual</p>
  </header>

  <!-- FORM -->
  <main class="max-w-2xl mx-auto mt-8 bg-white p-6 rounded-2xl shadow-lg">
    <h2 class="text-xl font-bold mb-4 text-center text-emerald-700">Isi Asasmen Pribadi</h2>

    <form id="formAsasmen" class="space-y-4">
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Nama Pengasuh:</label>
        <input type="text" id="nama" required
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none">
      </div>

      <div>
        <label class="block font-semibold text-gray-700 mb-1">Level Spiritualitas (1-10):</label>
        <input type="number" id="level" min="1" max="10" required
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none">
      </div>

      <div>
        <label class="block font-semibold text-gray-700 mb-1">Catatan Refleksi:</label>
        <textarea id="refleksi" rows="3"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none"
          placeholder="Tuliskan refleksi spiritual Anda..."></textarea>
      </div>

      <div class="flex justify-between mt-6">
        <button type="submit"
          class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-5 py-2 rounded-lg transition">ğŸ’¾ Simpan</button>

        <button type="button" id="lihatHasil"
          class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-2 rounded-lg transition">ğŸ“Š Lihat Hasil</button>
      </div>
    </form>
  </main>

  <!-- HASIL -->
  <section id="hasilContainer" class="max-w-2xl mx-auto mt-8 hidden bg-white/90 p-6 rounded-2xl shadow-lg mb-8">
    <h2 class="text-xl font-bold mb-4 text-center text-blue-700">ğŸ“˜ Hasil Asasmen Pengasuh</h2>
    <div id="hasilTabel" class="overflow-x-auto"></div>
  </section>

  <!-- FIREBASE SDK -->
  <script type="module">
    // Import modul Firebase versi 9+
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    // Konfigurasi Firebase Abah
    const firebaseConfig = {
      apiKey: "AIzaSyDuxvufRwadUsGh8-Kakl9KTG5ZGVcIoYQ",
      authDomain: "naik-level-81580.firebaseapp.com",
      projectId: "naik-level-81580",
      storageBucket: "naik-level-81580.firebasestorage.app",
      messagingSenderId: "319872430378",
      appId: "1:319872430378:web:64db1b51b159d27d622e53",
      measurementId: "G-RG7JS79MZ1"
    };

    // Inisialisasi Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Ambil elemen
    const form = document.getElementById("formAsasmen");
    const hasilContainer = document.getElementById("hasilContainer");
    const hasilTabel = document.getElementById("hasilTabel");
    const lihatHasilBtn = document.getElementById("lihatHasil");

    // Fungsi: Simpan data ke Firestore
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const nama = document.getElementById("nama").value.trim();
      const level = parseInt(document.getElementById("level").value);
      const refleksi = document.getElementById("refleksi").value.trim();
      const tanggal = new Date().toLocaleString("id-ID");

      if (!nama || !level) {
        alert("Nama dan level wajib diisi!");
        return;
      }

      try {
        await addDoc(collection(db, "asasmen_pengasuh"), {
          nama,
          level,
          refleksi,
          tanggal
        });
        form.reset();
        alert("âœ… Data berhasil disimpan ke Firebase!");
      } catch (error) {
        console.error("âŒ Gagal menyimpan data:", error);
        alert("Terjadi kesalahan saat menyimpan data.");
      }
    });

    // Fungsi: Menampilkan data dari Firestore
    lihatHasilBtn.addEventListener("click", async () => {
      hasilContainer.classList.add("hidden");
      hasilTabel.innerHTML = `<p class='text-center text-gray-500'>â³ Memuat data...</p>`;

      try {
        const q = query(collection(db, "asasmen_pengasuh"), orderBy("tanggal", "desc"));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          hasilTabel.innerHTML = `<p class='text-center text-gray-500'>Belum ada data.</p>`;
          return;
        }

        let tabelHTML = `
          <table class="w-full border border-gray-300 text-sm">
            <thead class="bg-emerald-600 text-white">
              <tr>
                <th class="py-2 px-3 border">No</th>
                <th class="py-2 px-3 border">Nama</th>
                <th class="py-2 px-3 border">Level</th>
                <th class="py-2 px-3 border">Refleksi</th>
                <th class="py-2 px-3 border">Tanggal</th>
              </tr>
            </thead>
            <tbody>
        `;

        let i = 1;
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          tabelHTML += `
            <tr class="odd:bg-gray-50 even:bg-gray-100 hover:bg-emerald-50 transition">
              <td class="border px-3 py-2 text-center">${i++}</td>
              <td class="border px-3 py-2">${data.nama}</td>
              <td class="border px-3 py-2 text-center font-semibold">${data.level}</td>
              <td class="border px-3 py-2">${data.refleksi || "-"}</td>
              <td class="border px-3 py-2 text-center">${data.tanggal}</td>
            </tr>
          `;
        });

        tabelHTML += "</tbody></table>";
        hasilTabel.innerHTML = tabelHTML;
        hasilContainer.classList.remove("hidden");
        window.scrollTo({ top: hasilContainer.offsetTop, behavior: "smooth" });

      } catch (error) {
        console.error("âŒ Gagal memuat data:", error);
        hasilTabel.innerHTML = `<p class='text-center text-red-500'>Gagal memuat data dari Firebase.</p>`;
      }
    });
  </script>

</body>
</html>
