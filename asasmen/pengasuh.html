<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asasmen Spiritual Pengasuh</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(to bottom right, #10b981, #0d9488);
      font-family: 'Poppins', sans-serif;
      color: #333;
    }
    .fade-in { animation: fadeIn 0.6s ease-in-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center">

  <!-- HEADER -->
  <header class="text-center text-white mt-6">
    <h1 class="text-3xl font-bold drop-shadow-lg">ğŸ•Šï¸ Asasmen Spiritual Pengasuh</h1>
    <p class="text-sm opacity-90 mt-1">Refleksi Naik Level Kesadaran Spiritual</p>
  </header>

  <!-- MAIN CARD -->
  <main class="max-w-3xl w-11/12 mt-6 bg-white/90 backdrop-blur-md p-6 rounded-2xl shadow-lg fade-in">
    
    <!-- FORM NAMA -->
    <div id="intro-container" class="text-center">
      <h2 class="text-xl font-bold text-emerald-700 mb-4">Identitas Pengasuh</h2>
      <input id="nama" type="text" placeholder="Masukkan nama lengkap Anda"
        class="w-full border border-emerald-300 px-4 py-3 rounded-lg mb-6 focus:ring-2 focus:ring-emerald-400 focus:outline-none">
      <button id="start-btn"
        class="bg-emerald-600 text-white px-6 py-2 rounded-lg hover:bg-emerald-700 font-semibold transition">
        ğŸš€ Mulai Asasmen
      </button>
    </div>

    <!-- ASESMEN -->
    <div id="question-container" class="hidden text-center fade-in">
      <p id="question-text" class="text-lg font-medium mb-6"></p>
      <div class="grid grid-cols-2 gap-4">
        <button class="answer-btn bg-gray-100 hover:bg-emerald-500 hover:text-white rounded-xl py-3 font-semibold transition" data-score="10">Tidak Pernah</button>
        <button class="answer-btn bg-gray-100 hover:bg-emerald-500 hover:text-white rounded-xl py-3 font-semibold transition" data-score="20">Kadang</button>
        <button class="answer-btn bg-gray-100 hover:bg-emerald-500 hover:text-white rounded-xl py-3 font-semibold transition" data-score="40">Sering</button>
        <button class="answer-btn bg-gray-100 hover:bg-emerald-500 hover:text-white rounded-xl py-3 font-semibold transition" data-score="80">Selalu</button>
      </div>
      <div class="mt-6 text-sm text-gray-500" id="progress-text"></div>
    </div>

    <!-- HASIL -->
    <div id="result-container" class="hidden text-center fade-in">
      <h2 class="text-2xl font-bold text-emerald-700 mb-4">ğŸ“Š Hasil Asasmen</h2>
      <p class="text-gray-700 mb-6">Tiga Level Spiritual yang paling dominan:</p>
      <div id="top-levels" class="space-y-3 text-lg font-semibold"></div>

      <div class="mt-10 flex flex-col gap-3">
        <button id="btnRiyadhah"
           class="bg-gradient-to-r from-emerald-500 to-teal-600 text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 shadow-md transition">
          ğŸŒ± Lihat Riyadhah yang Disarankan
        </button>
        <a href="../index.html"
           class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition">
          â¬…ï¸ Kembali ke Menu Utama
        </a>
      </div>
    </div>
  </main>

  <footer class="text-xs text-white/80 mt-8 mb-4">Â© 2025 Naik Level â€¢ Pesantren Fajrul Islam</footer>

  <!-- FIREBASE SDK -->
  <script type="module">
    import { db } from "../assets/firebase-config.js";
    import { collection, addDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const levels = [
      "MALU (Shame)", "RASA BERSALAH (Guilt)", "APATI (Apathy)", "BERDUKA (Grief)", "TAKUT (Fear)",
      "KEINGINAN (Desire)", "MARAH (Anger)", "BANGGA (Pride)", "KEBERANIAN (Courage)", "NETRALITAS (Neutrality)",
      "KEMAUAN (Willingness)", "PENERIMAAN (Acceptance)", "AKAL BUDI (Reason)", "CINTA (Love)",
      "SUKACITA (Joy)", "DAMAI (Peace)", "PENCERAHAN (Enlightenment)"
    ];

    const statements = [
      "Dalam 1 bulan terakhir, saya merasa tidak layak membimbing orang lain karena merasa diri penuh kekurangan.",
      "Dalam 1 bulan terakhir, saya memilih menarik diri dari peran kepengasuhan karena takut dinilai atau disalahpahami.",
      "Dalam 1 bulan terakhir, saya merasa Allah mungkin sudah tidak ridha atas pengabdian saya di pesantren.",
      "Dalam 1 bulan terakhir, saya merasa kehadiran saya justru membebani orang lain, bukan membawa manfaat.",

      "Dalam 1 bulan terakhir, saya sering teringat kesalahan masa lalu dan merasa belum pantas diampuni.",
      "Dalam 1 bulan terakhir, saya menolak ketenangan batin karena merasa belum menebus dosa atau kelalaian saya sebagai pengasuh.",
      "Dalam 1 bulan terakhir, saya berbuat baik dengan keras terhadap diri sendiri, bukan karena cinta, tapi karena ingin menebus kesalahan.",
      "Dalam 1 bulan terakhir, saya sulit memaafkan diri sendiri meski saya yakin Allah Maha Pengampun.",

      "Dalam 1 bulan terakhir, saya menjalankan peran pengasuhan secara mekanis, tanpa semangat dan tanpa makna.",
      "Dalam 1 bulan terakhir, saya merasa perubahan di pesantren percuma, seolah tidak ada yang bisa diperbaiki.",
      "Dalam 1 bulan terakhir, saya kehilangan arah dan makna dari pengabdian saya.",
      "Dalam 1 bulan terakhir, saya merasa mati rasa terhadap santri dan rekan kerja, seolah semua tidak lagi berarti.",

      "Dalam 1 bulan terakhir, saya sering mengenang masa lalu saat suasana pesantren terasa lebih baik.",
      "Dalam 1 bulan terakhir, saya merasa kesedihan atas perubahan di pesantren sulit saya lepaskan.",
      "Dalam 1 bulan terakhir, saya merasa kehilangan semangat lama dan sulit menemukan kembali gairah membina santri.",
      "Dalam 1 bulan terakhir, saya sering menyesali keputusan atau sikap saya di masa lalu.",

      "Dalam 1 bulan terakhir, saya menjalankan peran dengan cemas â€” takut salah, takut dikritik, atau takut mengecewakan pimpinan.",
      "Dalam 1 bulan terakhir, saya menghindari menegur atau mengambil keputusan karena takut menimbulkan konflik.",
      "Dalam 1 bulan terakhir, saya banyak memikirkan hal-hal buruk yang mungkin terjadi pada diri atau pesantren.",
      "Dalam 1 bulan terakhir, saya menjaga jarak dengan santri atau guru karena takut terluka secara emosional.",

      "Dalam 1 bulan terakhir, saya merasa gelisah bila program atau gagasan saya tidak dihargai.",
      "Dalam 1 bulan terakhir, saya membandingkan diri dengan pengasuh lain dan merasa iri dengan pencapaian mereka.",
      "Dalam 1 bulan terakhir, saya merasa terus mengejar sesuatu tapi tidak pernah benar-benar puas.",
      "Dalam 1 bulan terakhir, saya merasa semangat saya muncul hanya bila ada pujian, penghargaan, atau perhatian dari orang lain.",

      "Dalam 1 bulan terakhir, saya mudah tersinggung terhadap ucapan, perilaku, atau keputusan orang lain di pesantren.",
      "Dalam 1 bulan terakhir, suasana di sekitar saya sering menjadi tegang karena sikap saya yang keras atau reaktif.",
      "Dalam 1 bulan terakhir, saya menyimpan kekecewaan pada orang yang tidak sejalan dengan saya.",
      "Dalam 1 bulan terakhir, saya sering menyalahkan keadaan atau orang lain atas hasil yang tidak sesuai harapan.",

      "Dalam 1 bulan terakhir, saya sulit menerima masukan dari pengurus atau rekan sejawat yang lebih muda.",
      "Dalam 1 bulan terakhir, saya berusaha terlihat kuat dan sempurna agar tidak kehilangan wibawa.",
      "Dalam 1 bulan terakhir, saya menilai orang lain dari penampilan dan hasil lahiriah lebih dari niat dan perjuangannya.",
      "Dalam 1 bulan terakhir, saya cenderung mencari pembenaran diri saat salah, agar tetap terlihat benar di hadapan orang lain.",

      "Dalam 1 bulan terakhir, saya berani mengakui kesalahan di hadapan santri atau rekan kerja tanpa takut kehilangan wibawa.",
      "Dalam 1 bulan terakhir, saya memandang setiap masalah di pesantren sebagai tantangan yang bisa memperkuat tim.",
      "Dalam 1 bulan terakhir, saya mengambil langkah inisiatif untuk memperbaiki keadaan tanpa menunggu perintah.",
      "Dalam 1 bulan terakhir, saya merasa yakin bahwa Allah akan menolong selama saya jujur dan berusaha.",

      "Dalam 1 bulan terakhir, saya mampu menerima perubahan kebijakan atau dinamika pesantren dengan tenang.",
      "Dalam 1 bulan terakhir, saya tidak terburu-buru menghakimi, tetapi berusaha memahami situasi dari berbagai sisi.",
      "Dalam 1 bulan terakhir, saya bisa menyeimbangkan antara keseriusan bekerja dan waktu untuk istirahat.",
      "Dalam 1 bulan terakhir, saya tidak berlebihan menyesali hasil yang kurang baik, karena percaya Allah menilai niat, bukan sekadar hasil.",

      "Dalam 1 bulan terakhir, saya bekerja dengan antusias tanpa menunggu perintah, karena ingin memberi manfaat.",
      "Dalam 1 bulan terakhir, saya terus belajar hal-hal baru agar bisa menjadi pengasuh yang lebih bijak dan relevan.",
      "Dalam 1 bulan terakhir, saya menghadapi masalah pengasuhan dengan sikap belajar, bukan keluhan.",
      "Dalam 1 bulan terakhir, saya berusaha konsisten menjaga niat tulus dalam setiap pelayanan di pesantren.",

      "Dalam 1 bulan terakhir, saya mudah memaafkan guru, santri, atau staf yang berbuat salah.",
      "Dalam 1 bulan terakhir, saya menerima diri saya apa adanya â€” dengan kelebihan dan keterbatasan.",
      "Dalam 1 bulan terakhir, saya melihat hikmah dari setiap ujian, bahkan yang menyakitkan.",
      "Dalam 1 bulan terakhir, saya tetap tenang di tengah konflik atau perbedaan pandangan.",

      "Dalam 1 bulan terakhir, saya mengambil keputusan dengan berpikir jernih, berdasarkan data dan hikmah.",
      "Dalam 1 bulan terakhir, saya mencintai ilmu dan terus belajar dari berbagai sumber untuk memperluas wawasan pengasuhan.",
      "Dalam 1 bulan terakhir, saya sering menemukan tanda kebesaran Allah dalam sistem kehidupan pesantren yang tertata.",
      "Dalam 1 bulan terakhir, saya menyampaikan pendapat dengan tenang, rasional, dan menghormati perbedaan.",

      "Dalam 1 bulan terakhir, saya memperlakukan santri dan guru dengan kasih dan kelembutan hati.",
      "Dalam 1 bulan terakhir, saya mudah memaafkan tanpa menuntut balasan atau permintaan maaf.",
      "Dalam 1 bulan terakhir, saya membantu dan melayani dengan niat tulus, bukan demi pujian.",
      "Dalam 1 bulan terakhir, saya melihat keindahan dan kebaikan Allah dalam setiap aspek kehidupan pesantren.",

      "Dalam 1 bulan terakhir, saya merasa bahagia dan ringan dalam mengasuh, tanpa harus menunggu hasil besar.",
      "Dalam 1 bulan terakhir, saya menerima ujian dan kritik dengan rasa syukur karena itu bagian dari tarbiyah Allah.",
      "Dalam 1 bulan terakhir, saya membawa suasana cerah dan menenangkan bagi guru dan santri.",
      "Dalam 1 bulan terakhir, saya menikmati momen sederhana di pesantren â€” kebersamaan, adzan, dan tawa santri â€” dengan rasa syukur.",

      "Dalam 1 bulan terakhir, saya tetap tenang menghadapi berbagai persoalan pesantren.",
      "Dalam 1 bulan terakhir, saya berhenti mengeluh dan lebih banyak berserah diri kepada Allah.",
      "Dalam 1 bulan terakhir, kehadiran saya membuat orang lain merasa tenteram dan percaya diri.",
      "Dalam 1 bulan terakhir, saya merasakan ibadah bukan sekadar tugas, tapi perjumpaan yang saya rindukan.",

      "Dalam 1 bulan terakhir, saya merasa semua yang terjadi di pesantren adalah bagian dari kehendak Allah yang sempurna.",
      "Dalam 1 bulan terakhir, saya melihat kehadiran Allah dalam setiap jiwa yang saya temui.",
      "Dalam 1 bulan terakhir, saya hidup dengan tenang tanpa dorongan ego â€” cukup menjadi saluran kebaikan-Nya.",
      "Dalam 1 bulan terakhir, saya merasa kehadiran saya membawa kedamaian tanpa perlu banyak bicara."
    ];

    const startBtn = document.getElementById("start-btn");
    const introContainer = document.getElementById("intro-container");
    const questionContainer = document.getElementById("question-container");
    const questionText = document.getElementById("question-text");
    const progressText = document.getElementById("progress-text");
    const resultContainer = document.getElementById("result-container");
    const topLevels = document.getElementById("top-levels");
    const btnRiyadhah = document.getElementById("btnRiyadhah");

    let nama = "";
    let current = 0;
    const scores = {};

    startBtn.addEventListener("click", () => {
      nama = document.getElementById("nama").value.trim();
      if (!nama) {
        alert("Masukkan nama terlebih dahulu!");
        return;
      }
      introContainer.classList.add("hidden");
      questionContainer.classList.remove("hidden");
      showQuestion();
    });

    function showQuestion() {
      questionText.textContent = statements[current];
      progressText.textContent = `Pertanyaan ${current + 1} dari ${statements.length}`;
    }

    document.querySelectorAll(".answer-btn").forEach(btn => {
      btn.addEventListener("click", async () => {
        const score = parseInt(btn.dataset.score);
        const levelIndex = Math.floor(current / 4);
        const level = levels[levelIndex];
        scores[level] = (scores[level] || 0) + score;
        current++;

        if (current < statements.length) {
          showQuestion();
        } else {
          await saveToFirebase();
          showResult();
        }
      });
    });

    async function saveToFirebase() {
      try {
        await addDoc(collection(db, "asasmen_pengasuh"), {
          nama,
          tanggal: new Date().toLocaleString("id-ID"),
          hasil: scores
        });
        console.log("âœ… Data tersimpan di Firestore");
      } catch (err) {
        console.error("âŒ Gagal menyimpan:", err);
        alert("Terjadi kesalahan saat menyimpan data.");
      }
    }

    function showResult() {
      questionContainer.classList.add("hidden");
      resultContainer.classList.remove("hidden");

      const sorted = Object.entries(scores)
        .map(([level, score]) => ({ level, score }))
        .sort((a, b) => b.score - a.score)
        .slice(0, 3);

      topLevels.innerHTML = sorted
        .map((l, i) =>
          `<div class="bg-gradient-to-r from-emerald-50 to-teal-50 border-l-4 border-emerald-500 p-3 rounded text-left shadow-sm">
            <span class="font-bold text-emerald-700">#${i + 1}</span> 
            ${l.level} â€” <span class="text-gray-600">${l.score} poin</span>
          </div>`
        ).join("");

      // Simpan level dominan ke localStorage
      const topNames = sorted.map(l => l.level.split(" ")[0]); // ambil nama depan level
      localStorage.setItem("dominantLevels", JSON.stringify(topNames));
    }

    // Tombol Lihat Riyadhah
    btnRiyadhah.addEventListener("click", () => {
      window.location.href = "../riyadhah.html";
    });
  </script>
</body>
</html>
