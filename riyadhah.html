<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Riyadhah Naik Level Spiritual</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #a7f3d0 0, #0f766e 45%, #022c22 100%);
    }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="min-h-screen text-slate-800 flex flex-col">

  <!-- HEADER -->
  <header class="w-full px-4 pt-6 pb-4 sm:pt-8 sm:pb-6">
    <div class="max-w-5xl mx-auto flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <p class="text-xs uppercase tracking-[0.2em] text-emerald-100 mb-1">Naik Level Spiritual</p>
        <h1 class="text-2xl sm:text-3xl font-bold text-white drop-shadow">
          üå± Riyadhah Naik Level Pengasuh
        </h1>
        <p class="text-emerald-100 text-xs sm:text-sm mt-1 max-w-xl">
          Panduan latihan batin bertahap dari level Shame hingga Enlightenment, sebagai kelanjutan hasil asesmen spiritual.
        </p>
      </div>
      <div class="flex flex-wrap gap-2 justify-start sm:justify-end">
        <a href="asasmen/pengasuh.html"
           class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-white/90 text-emerald-700 text-xs sm:text-sm font-semibold shadow hover:bg-emerald-50 transition">
          ‚¨ÖÔ∏è Kembali ke Asasmen Pengasuh
        </a>
        <a href="index.html"
           class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-emerald-500/90 text-white text-xs sm:text-sm font-semibold shadow hover:bg-emerald-600 transition">
          üè† Menu Utama
        </a>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="flex-1 w-full px-4 pb-8">
    <section class="max-w-5xl mx-auto bg-white/90 backdrop-blur-md rounded-3xl shadow-lg p-4 sm:p-6 md:p-8 fade-in">

      <!-- Info atas -->
      <div class="mb-6 sm:mb-8 text-center">
        <h2 class="text-lg sm:text-xl font-semibold text-emerald-800 mb-2">
          Riyadhah yang Direkomendasikan untuk Anda
        </h2>
        <p id="levelInfo" class="text-xs sm:text-sm text-slate-600">
          Berdasarkan hasil asesmen spiritual Anda, berikut Riyadhah yang relevan untuk dilakukan.
        </p>
      </div>

      <!-- GRID KARTU -->
      <div id="cardsContainer" class="grid gap-4 sm:gap-5 md:gap-6 grid-cols-1 md:grid-cols-2">
        <!-- Kartu akan di-render via JavaScript -->
      </div>
    </section>
  </main>

  <footer class="w-full py-4 text-center text-[11px] text-emerald-100/80">
    ¬© 2025 Naik Level ‚Ä¢ Pesantren Fajrul Islam
  </footer>

  <!-- MODAL DETAIL -->
  <div id="riyadhahModal"
       class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-start md:items-center justify-center px-4 py-10 z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[80vh] overflow-y-auto relative p-5 sm:p-6 md:p-7">
      <button id="modalCloseBtn"
              class="absolute top-3 right-3 sm:top-4 sm:right-4 text-slate-400 hover:text-slate-600 text-lg">
        ‚úï
      </button>

      <div class="mb-3">
        <p id="modalLabel" class="text-[11px] uppercase tracking-[0.2em] text-emerald-500"></p>
        <h2 id="modalTitle" class="text-lg sm:text-xl font-semibold text-slate-800 mt-1"></h2>
      </div>

      <div id="modalBody" class="space-y-3 text-xs sm:text-sm text-slate-700 leading-relaxed">
        <!-- isi riyadhah -->
      </div>

      <div class="mt-5 border-t pt-3 sm:pt-4 flex flex-wrap gap-2 justify-between items-center">
        <p class="text-[11px] sm:text-xs text-slate-400">
          Disarankan diamalkan konsisten minimal 40 hari dengan bimbingan mursyid / supervisor.
        </p>
        <a href="asasmen/pengasuh.html"
           class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-emerald-600 text-white text-xs font-semibold hover:bg-emerald-700 transition">
          ‚¨ÖÔ∏è Kembali ke Hasil Asasmen
        </a>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    const gradients = [
      "from-rose-500 to-orange-400",
      "from-orange-400 to-amber-300",
      "from-amber-300 to-yellow-300",
      "from-yellow-300 to-lime-400",
      "from-lime-400 to-emerald-400",
      "from-emerald-400 to-teal-400",
      "from-teal-400 to-cyan-400",
      "from-cyan-400 to-sky-400",
      "from-sky-400 to-blue-500",
      "from-blue-500 to-indigo-500",
      "from-indigo-500 to-violet-500",
      "from-violet-500 to-fuchsia-500",
      "from-fuchsia-500 to-pink-500",
      "from-pink-500 to-rose-500",
      "from-slate-500 to-slate-700",
      "from-emerald-700 to-emerald-900"
    ];

    // üß≠ Pemetaan bilingual Indonesia ‚Üí Inggris
    const levelMap = {
      "MALU": "shame",
      "RASA BERSALAH": "guilt",
      "APATI": "apathy",
      "BERDUKA": "grief",
      "TAKUT": "fear",
      "KEINGINAN": "desire",
      "MARAH": "anger",
      "BANGGA": "pride",
      "KEBERANIAN": "courage",
      "NETRALITAS": "neutrality",
      "KEMAUAN": "willingness",
      "PENERIMAAN": "acceptance",
      "AKAL BUDI": "reason",
      "CINTA": "love",
      "SUKACITA": "joy",
      "DAMAI": "peace",
      "PENCERAHAN": "enlightenment"
    };

    let riyadhahData = [];

    async function loadRiyadhah() {
      const container = document.getElementById("cardsContainer");
      const levelInfo = document.getElementById("levelInfo");
      container.innerHTML = `
        <div class="col-span-1 md:col-span-2 flex justify-center py-6">
          <div class="flex items-center gap-2 text-sm text-slate-600">
            <span class="animate-spin inline-block w-4 h-4 border-2 border-emerald-500 border-t-transparent rounded-full"></span>
            <span>Memuat panduan riyadhah...</span>
          </div>
        </div>
      `;

      try {
        const res = await fetch("riyadhah-data.json");
        riyadhahData = await res.json();

        const storedLevels = JSON.parse(localStorage.getItem("dominantLevels")) || [];
        console.log("üéØ Level Dominan:", storedLevels);

        let filtered = riyadhahData;

        if (storedLevels.length > 0) {
          filtered = riyadhahData.filter(item =>
            storedLevels.some(lvl => {
              const engEquivalent = levelMap[lvl.toUpperCase()] || "";
              const label = item.levelLabel.toLowerCase();
              return (
                label.includes(lvl.toLowerCase()) ||
                label.includes(engEquivalent.toLowerCase())
              );
            })
          );

          levelInfo.innerHTML = `
            Berdasarkan hasil asesmen spiritual Anda:
            <span class="font-semibold text-emerald-600">${storedLevels.join(", ")}</span>.
            Berikut Riyadhah yang relevan untuk dilakukan.
          `;
        } else {
          levelInfo.textContent =
            "Belum ditemukan hasil asesmen. Silakan selesaikan Asasmen Pengasuh terlebih dahulu.";
        }

        renderCards(filtered);
      } catch (err) {
        console.error(err);
        container.innerHTML = `
          <div class="col-span-1 md:col-span-2 bg-rose-50 border border-rose-200 text-rose-700 text-sm rounded-xl p-4">
            Terjadi kesalahan saat memuat data riyadhah. Pastikan file
            <code class="px-1 py-0.5 rounded bg-rose-100 text-[11px]">riyadhah-data.json</code>
            berada di folder yang sama dengan <code class="px-1 py-0.5 rounded bg-rose-100 text-[11px]">riyadhah.html</code>.
          </div>
        `;
      }
    }

    function renderCards(data) {
      const container = document.getElementById("cardsContainer");
      if (!Array.isArray(data) || data.length === 0) {
        container.innerHTML = `
          <div class="col-span-1 md:col-span-2 text-center text-sm text-slate-600 py-10">
            Tidak ada Riyadhah yang sesuai dengan level Anda.
          </div>
        `;
        return;
      }

      container.innerHTML = data.map((item, index) => {
        const gradient = gradients[index % gradients.length];
        const actionsHtml = (item.bullets || [])
          .slice(0, 4)
          .map(b => `
            <li class="flex items-start gap-2">
              <span class="mt-[3px] text-emerald-500">‚Ä¢</span>
              <span>${b}</span>
            </li>
          `).join("");

        return `
          <article class="rounded-2xl bg-gradient-to-r ${gradient} p-[1px] shadow-md">
            <div class="bg-white/95 rounded-2xl p-4 sm:p-5 h-full flex flex-col">
              <p class="text-[11px] uppercase tracking-[0.2em] text-emerald-500 mb-1">
                ${item.levelLabel || "Riyadhah Naik Level"}
              </p>
              <h3 class="text-sm sm:text-base md:text-lg font-semibold text-slate-800 mb-1.5">
                ${item.shortTitle}
              </h3>
              <p class="text-[11px] sm:text-xs text-slate-600 mb-3">
                ${item.summary}
              </p>
              <ul class="text-xs sm:text-[13px] text-slate-700 space-y-1.5 text-left flex-1">
                ${actionsHtml}
              </ul>
              <button
                class="mt-3 inline-flex items-center justify-center self-start px-3 py-1.5 rounded-lg bg-emerald-600 text-white text-xs sm:text-[13px] font-semibold hover:bg-emerald-700 transition"
                onclick="openRiyadhahModal('${item.id}')">
                üìñ Baca Selengkapnya
              </button>
            </div>
          </article>
        `;
      }).join("");
    }

    function openRiyadhahModal(id) {
      const item = riyadhahData.find(r => r.id === id);
      if (!item) return;

      const modal = document.getElementById("riyadhahModal");
      const modalTitle = document.getElementById("modalTitle");
      const modalLabel = document.getElementById("modalLabel");
      const modalBody = document.getElementById("modalBody");

      modalTitle.textContent = item.title || item.shortTitle || "Riyadhah Naik Level";
      modalLabel.textContent = item.levelLabel || "";
      modalBody.innerHTML = "";

      (item.full || []).forEach(par => {
        const p = document.createElement("p");
        p.textContent = par;
        modalBody.appendChild(p);
      });

      modal.classList.remove("hidden");
      document.body.classList.add("overflow-hidden");
    }

    function closeRiyadhahModal() {
      const modal = document.getElementById("riyadhahModal");
      modal.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
    }

    window.openRiyadhahModal = openRiyadhahModal;

    document.addEventListener("DOMContentLoaded", () => {
      loadRiyadhah();
      const modal = document.getElementById("riyadhahModal");
      const closeBtn = document.getElementById("modalCloseBtn");

      closeBtn.addEventListener("click", closeRiyadhahModal);
      modal.addEventListener("click", (e) => {
        if (e.target === modal) closeRiyadhahModal();
      });
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && !modal.classList.contains("hidden")) closeRiyadhahModal();
      });
    });
  </script>
</body>
</html>
